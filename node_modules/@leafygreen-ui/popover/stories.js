import t,{forwardRef as e,useState as n,useMemo as o,Fragment as r,useRef as i}from"react";import{storybookExcludedControlParams as a}from"@lg-tools/storybook-utils";import c from"@leafygreen-ui/button";import{css as l,cx as s}from"@leafygreen-ui/emotion";import{palette as u}from"@leafygreen-ui/palette";import{Transition as f}from"react-transition-group";import p from"prop-types";import{useViewportSize as d,useMutationObserver as g,useObjectDependency as h,usePrevious as m,useIsomorphicLayoutEffect as v}from"@leafygreen-ui/hooks";import{usePopoverContext as y,usePopoverPortalContainer as w}from"@leafygreen-ui/leafygreen-provider";import{createUniqueClassName as b,consoleOnce as E}from"@leafygreen-ui/lib";import P from"@leafygreen-ui/portal";import{transitionDuration as j}from"@leafygreen-ui/tokens";function x(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function O(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?x(Object(n),!0).forEach((function(e){C(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):x(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function C(t,e,n){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var o=n.call(t,e||"default");if("object"!=typeof o)return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function S(){return S=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o])}return t},S.apply(this,arguments)}function T(t,e){if(null==t)return{};var n,o,r=function(t,e){if(null==t)return{};var n,o,r={},i=Object.keys(t);for(o=0;o<i.length;o++)n=i[o],e.indexOf(n)>=0||(r[n]=t[n]);return r}(t,e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);for(o=0;o<i.length;o++)n=i[o],e.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(t,n)&&(r[n]=t[n])}return r}function N(t,e){return e||(e=t.slice(0)),Object.freeze(Object.defineProperties(t,{raw:{value:Object.freeze(e)}}))}function D(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var o,r,i,a,c=[],l=!0,s=!1;try{if(i=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;l=!1}else for(;!(l=(o=i.call(n)).done)&&(c.push(o.value),c.length!==e);l=!0);}catch(t){s=!0,r=t}finally{try{if(!l&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(s)throw r}}return c}}(t,e)||R(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function H(t){return function(t){if(Array.isArray(t))return B(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||R(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function R(t,e){if(t){if("string"==typeof t)return B(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?B(t,e):void 0}}function B(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=new Array(e);n<e;n++)o[n]=t[n];return o}var V,M,F,L,z,W,k,A,I={Top:"top",Bottom:"bottom",Left:"left",Right:"right",CenterVertical:"center-vertical",CenterHorizontal:"center-horizontal"},U={Start:"start",Middle:"middle",End:"end",Fit:"fit"};function Z(t){var e=t.useRelativePositioning,n=t.spacing,o=t.align,r=t.justify,i=t.referenceElViewportPos,a=void 0===i?X:i,c=t.referenceElDocumentPos,l=void 0===c?X:c,s=t.contentElViewportPos,u=void 0===s?X:s,f=t.contentElDocumentPos,p=void 0===f?X:f,d=t.scrollContainer,g=t.windowHeight,h=void 0===g?window.innerHeight:g,m=t.windowWidth,v=void 0===m?window.innerWidth:m,y=d?d.offsetWidth:v,w=d?d.offsetHeight:h,b={windowWidth:y,windowHeight:w,referenceElViewportPos:a,contentElViewportPos:u,spacing:n},E=function(t,e){var n=e.spacing,o=e.windowWidth,r=e.windowHeight,i=e.contentElViewportPos,a=e.referenceElViewportPos,c=[t].concat(H(ct[t]));return c.find((function(t){return[I.Top,I.Bottom,I.CenterVertical].includes(t)?at({top:ot({align:t,contentElPos:i,referenceElPos:a,spacing:n}),windowHeight:r,contentHeight:i.height}):!![I.Left,I.Right,I.CenterHorizontal].includes(t)&&it({left:rt({align:t,contentElPos:i,referenceElPos:a,spacing:n}),windowWidth:o,contentWidth:i.width})}))||t}(o,b),P=function(t,e,n){var o,r,i=n.spacing,a=n.windowWidth,c=n.windowHeight,l=n.contentElViewportPos,s=n.referenceElViewportPos,u=[t].concat(H(lt[t]));switch(e){case I.Top:case I.Bottom:case I.CenterVertical:return null!==(o=u.find((function(t){return it({contentWidth:t===U.Fit?s.width:l.width,windowWidth:a,left:rt({contentElPos:l,referenceElPos:s,spacing:i,align:e,justify:t})})})))&&void 0!==o?o:lt[t][0];case I.Left:case I.Right:case I.CenterHorizontal:return null!==(r=u.find((function(t){return at({contentHeight:t===U.Fit?s.height:l.height,windowHeight:c,top:ot({contentElPos:l,referenceElPos:s,spacing:i,align:e,justify:t})})})))&&void 0!==r?r:lt[t][0]}}(r,E,b),j=function(t){var e,n,o=t.align,r=t.justify,i=K[o],a=null!==(e=i.x)&&void 0!==e?e:J[r],c=null!==(n=i.y)&&void 0!==n?n:G[r];return"".concat(a," ").concat(c)}({align:E,justify:P}),x=function(t,e){var n=.8;switch(t){case I.Top:return"translate3d(0, ".concat(e,"px, 0) scale(").concat(n,")");case I.Bottom:return"translate3d(0, -".concat(e,"px, 0) scale(").concat(n,")");case I.Left:return"translate3d(".concat(e,"px, 0, 0) scale(").concat(n,")");case I.Right:return"translate3d(-".concat(e,"px, 0, 0) scale(").concat(n,")");case I.CenterHorizontal:case I.CenterVertical:return"scale(".concat(n,")")}}(E,n);return 0===Math.floor(u.width)&&r!==U.Fit?{align:o,justify:r,positionCSS:{left:0,top:0,transform:x,transformOrigin:j}}:e?{align:E,justify:P,positionCSS:O(O({},et({align:E,justify:P,referenceElDocumentPos:l,contentElDocumentPos:p,spacing:n})),{},{transformOrigin:j,transform:x})}:{align:E,justify:P,positionCSS:O(O({},nt({align:E,justify:P,referenceElDocumentPos:l,contentElDocumentPos:p,spacing:n,windowHeight:w,windowWidth:y})),{},{transformOrigin:j,transform:x})}}var X={top:0,bottom:0,left:0,right:0,height:0,width:0},Y=function(t,e){var n=t.getBoundingClientRect(),o=n.top,r=n.bottom,i=n.left,a=n.right,c=n.width;return{top:o,bottom:r,left:i,right:a,height:t.offsetHeight,width:e?c:parseFloat(getComputedStyle(t).width)}};function $(t,e,n){if(!t)return X;var o=Y(t,n),r=o.top,i=o.bottom,a=o.left,c=o.right,l=o.height,s=o.width;if(e){var u=e.scrollTop,f=e.scrollLeft,p=e.getBoundingClientRect();return{top:r+u-p.top,bottom:i+u-p.bottom,left:a+f-p.left,right:c+f-p.right,height:l,width:s}}var d=window,g=d.scrollX,h=d.scrollY;return{top:r+h,bottom:i+h,left:a+g,right:c+g,height:l,width:s}}function q(t,e,n){if(!t)return X;var o=Y(t,n),r=o.top,i=o.bottom,a=o.left,c=o.right,l=o.height,s=o.width;if(e){var u=e.getBoundingClientRect();return{top:r-u.top,bottom:i-u.bottom,left:a-u.left,right:c-u.right,height:l,width:s}}return{top:r,bottom:i,left:a,right:c,height:l,width:s}}var G=(C(V={},U.Start,"top"),C(V,U.Middle,"center"),C(V,U.End,"bottom"),C(V,U.Fit,"center"),V),J=(C(M={},U.Start,"left"),C(M,U.Middle,"center"),C(M,U.End,"right"),C(M,U.Fit,"center"),M),K=(C(F={},I.Left,{x:"right"}),C(F,I.Right,{x:"left"}),C(F,I.Top,{y:"bottom"}),C(F,I.Bottom,{y:"top"}),C(F,I.CenterHorizontal,{x:"center"}),C(F,I.CenterVertical,{y:"center"}),F);var Q=(C(L={},U.Start,{top:0}),C(L,U.End,{bottom:0}),C(L,U.Middle,(function(t){var e=t.contentElDocumentPos,n=t.referenceElDocumentPos;return{top:"".concat(n.height/2-e.height/2,"px")}})),C(L,U.Fit,{top:0,bottom:0}),L),_=(C(z={},U.Start,{left:0}),C(z,U.End,{right:0}),C(z,U.Middle,(function(t){var e=t.contentElDocumentPos,n=t.referenceElDocumentPos;return{left:"".concat(n.width/2-e.width/2,"px")}})),C(z,U.Fit,{left:0,right:0}),z),tt=(C(W={},I.Top,{constant:function(t){var e=t.spacing;return{bottom:"calc(100% + ".concat(e,"px)")}},justifyPositions:_}),C(W,I.Bottom,{constant:function(t){var e=t.spacing;return{top:"calc(100% + ".concat(e,"px)")}},justifyPositions:_}),C(W,I.CenterVertical,{constant:function(t){var e=t.referenceElDocumentPos;return{top:"calc(".concat(e.height/2,"px - 50%)")}},justifyPositions:_}),C(W,I.Left,{constant:function(t){var e=t.spacing;return{right:"calc(100% + ".concat(e,"px)")}},justifyPositions:Q}),C(W,I.Right,{constant:function(t){var e=t.spacing;return{left:"calc(100% + ".concat(e,"px)")}},justifyPositions:Q}),C(W,I.CenterHorizontal,{constant:function(t){var e=t.referenceElDocumentPos;return{left:"calc(".concat(e.width/2,"px - 50%)")}},justifyPositions:Q}),W);function et(t){var e,n=t.align,o=t.justify,r=t.referenceElDocumentPos,i=t.contentElDocumentPos,a=t.spacing,c=tt[n],l=c.justifyPositions[o],s={contentElDocumentPos:i,referenceElDocumentPos:r,spacing:a};return O(O({},null===(e=c.constant)||void 0===e?void 0:e.call(c,s)),"function"==typeof l?l(s):l)}function nt(t){var e=t.align,n=t.justify,o=t.referenceElDocumentPos,r=t.contentElDocumentPos,i=t.spacing,a=t.windowWidth,c=t.windowHeight,l=rt({align:e,justify:n,referenceElPos:o,contentElPos:r,spacing:i}),s="".concat(l,"px"),u="".concat(ot({align:e,justify:n,referenceElPos:o,contentElPos:r,spacing:i}),"px");return n!==U.Fit?{left:s,top:u}:[I.Left,I.Right,I.CenterHorizontal].includes(e)?{left:s,top:u,bottom:"".concat(c-o.bottom,"px")}:{left:s,top:u,right:"".concat(a-(l+o.width),"px")}}function ot(t){var e=t.align,n=t.justify,o=t.contentElPos,r=t.referenceElPos,i=t.spacing;switch(e){case I.Left:case I.Right:case I.CenterHorizontal:switch(n){case U.Start:case U.Fit:return r.top;case U.End:return r.top+r.height-o.height;case U.Middle:default:return r.top-(o.height-r.height)/2}case I.CenterVertical:return r.top-(o.height-r.height)/2;case I.Top:return r.top-o.height-i;case I.Bottom:default:return r.top+r.height+i}}function rt(t){var e=t.align,n=t.justify,o=t.contentElPos,r=t.referenceElPos,i=t.spacing;switch(e){case I.Top:case I.Bottom:case I.CenterVertical:switch(n){case U.End:return r.left+r.width-o.width;case U.Middle:return r.left-(o.width-r.width)/2;case U.Start:case U.Fit:default:return r.left}case I.Left:return r.left-o.width-i;case I.Right:return r.left+r.width+i;case I.CenterHorizontal:default:return r.left-(o.width-r.width)/2}}function it(t){var e=t.left,n=t.windowWidth,o=t.contentWidth;return e>=0&&!(e+o>n)}function at(t){var e=t.top,n=t.windowHeight,o=t.contentHeight;return e>=0&&!(e+o>n)}var ct=(C(k={},I.Top,[I.Bottom]),C(k,I.Bottom,[I.Top]),C(k,I.Left,[I.Right]),C(k,I.Right,[I.Left]),C(k,I.CenterHorizontal,[I.Left,I.Right]),C(k,I.CenterVertical,[I.Top,I.Bottom]),k);var lt=(C(A={},U.Start,[U.End,U.Middle]),C(A,U.Middle,[U.End,U.Start]),C(A,U.End,[U.Start,U.Middle]),C(A,U.Fit,[U.Middle,U.Start,U.End]),A);var st,ut,ft,pt,dt,gt=["active","spacing","align","justify","adjustOnMutation","children","className","popoverZIndex","refEl","usePortal","portalClassName","portalContainer","portalRef","scrollContainer","onEnter","onEntering","onEntered","onExit","onExiting","onExited"],ht=["transform"],mt=l(st||(st=N(["\n  position: absolute;\n  transition: transform ","ms ease-in-out,\n    opacity ","ms ease-in-out;\n  opacity: 0;\n"])),j.default,j.default),vt={attributes:!0,characterData:!0,childList:!0,subtree:!0},yt=b("popover-content"),wt=e((function(e,i){var a,c=e.active,u=void 0!==c&&c,p=e.spacing,b=void 0===p?10:p,x=e.align,O=void 0===x?I.Bottom:x,H=e.justify,R=void 0===H?U.Start:H,B=e.adjustOnMutation,V=void 0!==B&&B,M=e.children,F=e.className,L=e.popoverZIndex,z=e.refEl,W=e.usePortal,k=void 0===W||W,A=e.portalClassName,X=e.portalContainer,Y=e.portalRef,G=e.scrollContainer,J=e.onEnter,K=e.onEntering,Q=e.onEntered,_=e.onExit,tt=e.onExiting,et=e.onExited,nt=T(e,gt),ot=D(n(null),2),rt=ot[0],it=ot[1],at=D(n(null),2),ct=at[0],lt=at[1],st=D(n(0),2),wt=st[0],bt=st[1],Et=y().setIsPopoverOpen,Pt=w(),jt=Pt.portalContainer,xt=Pt.scrollContainer;jt=X||jt,xt=G||xt,k&&xt&&(xt.contains(jt)||E.warn("To ensure correct positioning make sure that the portalContainer element is inside of the scrollContainer"));var Ot=t.useRef(ct);Ot.current=ct;var Ct=null;if(z&&z.current)Ct=z.current;else if(rt){var St=rt.parentNode;St&&St instanceof HTMLElement&&(Ct=St)}var Tt=d(),Nt=V&&u,Dt=g(Ct,vt,Date.now,Nt),Ht=g(null==ct?void 0:ct.parentNode,vt,Date.now,Nt),Rt=h(q(Ct,xt,!0)),Bt=h(q(null==ct?void 0:ct.parentNode,xt)),Vt=h(o((function(){return $(Ct,xt,!0)}),[Ct,xt,Tt,Dt,u,O,R,wt])),Mt=h(o((function(){return $(ct)}),[null==ct?void 0:ct.parentNode,Tt,Ht,u,O,R,wt])),Ft=m(R),Lt=m(O),zt=Ft!==R&&(R===U.Fit||Ft===U.Fit)||Lt!==O&&R===U.Fit;v((function(){zt&&bt((function(t){return t+1}))}),[zt]);var Wt=D(n(!1),2),kt=Wt[0],At=Wt[1];if(v((function(){return At(!0)}),[]),!kt)return null;var It,Ut=Z({useRelativePositioning:!k,spacing:b,align:O,justify:R,referenceElViewportPos:Rt,referenceElDocumentPos:Vt,contentElViewportPos:Bt,contentElDocumentPos:Mt,scrollContainer:xt}),Zt=Ut.align,Xt=Ut.justify,Yt=Ut.positionCSS,$t=Yt.transform,qt=T(Yt,ht),Gt=l(ut||(ut=N(["\n      opacity: 1;\n      position: ",";\n      pointer-events: initial;\n    "])),k?"":"absolute"),Jt=k?P:r,Kt={className:jt?void 0:A,container:null!==(a=jt)&&void 0!==a?a:void 0,portalRef:Y},Qt=k?Kt:{};return It=null==M?null:"function"==typeof M?M({align:Zt,justify:Xt,referenceElPos:Vt}):M,t.createElement(f,{nodeRef:Ot,in:u,timeout:j.default,mountOnEnter:!0,unmountOnExit:!0,appear:!0,onEntering:K,onEnter:J,onEntered:function(){Et(!0);for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];null==Q||Q.apply(void 0,e)},onExiting:tt,onExit:_,onExited:function(){Et(!1);for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];null==et||et.apply(void 0,e)}},(function(e){var n;return t.createElement(t.Fragment,null,t.createElement("span",{ref:it,className:l(ft||(ft=N(["\n                display: none;\n              "])))}),t.createElement(Jt,Qt,t.createElement("div",S({},nt,{ref:i,className:s(mt,l(qt),(n={},C(n,l({transform:$t}),"entering"===e||"exiting"===e),C(n,Gt,"entered"===e),C(n,l(pt||(pt=N(["\n                      z-index: ",";\n                    "])),L),"number"==typeof L),n),F,C({},l(dt||(dt=N(["\n                      transition-delay: 0ms;\n                    "]))),"exiting"===e))}),t.createElement("div",{ref:lt,className:yt},It))))}))}));wt.displayName="Popover",wt.propTypes={children:p.oneOfType([p.node,p.func]),active:p.bool,className:p.string,align:p.oneOf(Object.values(I)),justify:p.oneOf(Object.values(U)),refEl:p.shape({current:"undefined"!=typeof window?p.instanceOf(Element):p.any}),usePortal:p.bool,portalClassName:p.string,spacing:p.number,adjustOnMutation:p.bool};var bt,Et,Pt,jt,xt,Ot,Ct,St,Tt,Nt,Dt,Ht=["refButtonPosition","buttonText"],Rt=["refButtonPosition","buttonText"],Bt=l(bt||(bt=N(["\n  border: 1px solid ",";\n  text-align: center;\n  padding: 12px;\n  max-height: 100%;\n  overflow: hidden;\n  // Reset these properties since they'll be inherited\n  // from the container element when not using a portal.\n  font-size: initial;\n  color: initial;\n  background-color: initial;\n"])),u.gray.light1),Vt=l(Et||(Et=N(["\n  position: relative;\n  width: 100%;\n  height: 100%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n"]))),Mt=l(Pt||(Pt=N(["\n  width: 500px;\n  height: 90vh;\n  background-color: ",";\n  overflow: scroll;\n  position: relative;\n"])),u.gray.light2),Ft=l(jt||(jt=N(["\n  position: relative;\n  height: 130vh;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n"]))),Lt=l(xt||(xt=N(["\n  position: relative;\n"]))),zt={centered:l(Ot||(Ot=N(["\n    position: relative;\n  "]))),top:l(Ct||(Ct=N(["\n    top: 0;\n    position: absolute;\n  "]))),right:l(St||(St=N(["\n    right: 0;\n    position: absolute;\n  "]))),bottom:l(Tt||(Tt=N(["\n    bottom: 0;\n    position: absolute;\n  "]))),left:l(Nt||(Nt=N(["\n    left: 0;\n    position: absolute;\n  "])))},Wt={title:"Components/Popover",component:wt,parameters:{default:"LiveExample",controls:{exclude:[].concat(H(a),["children","active","refEl","portalClassName","refButtonPosition","usePortal"])},generate:{combineArgs:{align:Object.values(I),justify:Object.values(U)},args:{active:!0,children:t.createElement("div",{className:Bt},"Popover content")},decorator:function(e){var n=i(null);return t.createElement("div",{className:l(Dt||(Dt=N(["\n              position: relative;\n              width: 50vw;\n              height: 150px;\n              display: flex;\n              align-items: center;\n              justify-content: center;\n            "])))},t.createElement(c,{ref:n},"refEl"),t.createElement(e,{refEl:n}))}}},args:{align:I.Top,justify:U.Start,spacing:10,adjustOnMutation:!1,buttonText:"Button Text"},argTypes:{buttonText:{type:"string",description:"Storybook only prop. Used to change the reference button text"},refButtonPosition:{options:["centered","top","right","bottom","left"],control:{type:"select"},description:"Storybook only prop. Used to change position of the reference button",defaultValue:"centered"}}},kt=function(e){var o=e.refButtonPosition,r=e.buttonText,i=T(e,Ht),a=D(n(!1),2),l=a[0],u=a[1],f=zt[o];return t.createElement("div",{className:Vt},t.createElement(c,{className:s(Lt,f),onClick:function(){return u((function(t){return!t}))}},r,t.createElement(wt,S({},i,{active:l}),t.createElement("div",{className:Bt},"Popover content"))))};kt.parameters={chromatic:{disableSnapshot:!0}};var At=function(e){var o=e.refButtonPosition,r=e.buttonText,a=T(e,Rt),l=D(n(!1),2),s=l[0],u=l[1],f=i(null),p=i(null),d=zt[o];return t.createElement("div",{className:Mt},t.createElement("div",{className:Ft,ref:p},t.createElement(c,{onClick:function(){return u((function(t){return!t}))},className:d},r,t.createElement(wt,S({},a,{active:s,portalContainer:p.current,portalRef:f,scrollContainer:p.current}),t.createElement("div",{className:Bt},"Popover content")))))};At.parameters={chromatic:{disableSnapshot:!0}},At.args={usePortal:!0},At.argTypes={usePortal:{control:"none"},portalClassName:{control:"none"},refEl:{control:"none"},className:{control:"none"},active:{control:"none"}};var It=function(){};export{It as Generated,kt as LiveExample,At as ScrollableContainer,Wt as default};
