import t,{forwardRef as e,useState as n,useMemo as r,Fragment as o}from"react";import{Transition as i}from"react-transition-group";import a from"prop-types";import{css as c,cx as l}from"@leafygreen-ui/emotion";import{useViewportSize as s,useMutationObserver as u,useObjectDependency as f,usePrevious as d,useIsomorphicLayoutEffect as p}from"@leafygreen-ui/hooks";import{usePopoverContext as g,usePopoverPortalContainer as h}from"@leafygreen-ui/leafygreen-provider";import{createUniqueClassName as m,consoleOnce as v}from"@leafygreen-ui/lib";import w from"@leafygreen-ui/portal";import{transitionDuration as y}from"@leafygreen-ui/tokens";function E(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function b(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?E(Object(n),!0).forEach((function(e){P(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):E(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function P(t,e,n){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function j(){return j=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},j.apply(this,arguments)}function O(t,e){if(null==t)return{};var n,r,o=function(t,e){if(null==t)return{};var n,r,o={},i=Object.keys(t);for(r=0;r<i.length;r++)n=i[r],e.indexOf(n)>=0||(o[n]=t[n]);return o}(t,e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);for(r=0;r<i.length;r++)n=i[r],e.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(t,n)&&(o[n]=t[n])}return o}function C(t,e){return e||(e=t.slice(0)),Object.freeze(Object.defineProperties(t,{raw:{value:Object.freeze(e)}}))}function x(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,i,a,c=[],l=!0,s=!1;try{if(i=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;l=!1}else for(;!(l=(r=i.call(n)).done)&&(c.push(r.value),c.length!==e);l=!0);}catch(t){s=!0,o=t}finally{try{if(!l&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(s)throw o}}return c}}(t,e)||D(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function S(t){return function(t){if(Array.isArray(t))return H(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||D(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function D(t,e){if(t){if("string"==typeof t)return H(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?H(t,e):void 0}}function H(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var R,T,V,F,M,N,B,L,z={Top:"top",Bottom:"bottom",Left:"left",Right:"right",CenterVertical:"center-vertical",CenterHorizontal:"center-horizontal"},W={Start:"start",Middle:"middle",End:"end",Fit:"fit"};function A(t){var e=t.useRelativePositioning,n=t.spacing,r=t.align,o=t.justify,i=t.referenceElViewportPos,a=void 0===i?I:i,c=t.referenceElDocumentPos,l=void 0===c?I:c,s=t.contentElViewportPos,u=void 0===s?I:s,f=t.contentElDocumentPos,d=void 0===f?I:f,p=t.scrollContainer,g=t.windowHeight,h=void 0===g?window.innerHeight:g,m=t.windowWidth,v=void 0===m?window.innerWidth:m,w=p?p.offsetWidth:v,y=p?p.offsetHeight:h,E={windowWidth:w,windowHeight:y,referenceElViewportPos:a,contentElViewportPos:u,spacing:n},P=function(t,e){var n=e.spacing,r=e.windowWidth,o=e.windowHeight,i=e.contentElViewportPos,a=e.referenceElViewportPos,c=[t].concat(S(rt[t]));return c.find((function(t){return[z.Top,z.Bottom,z.CenterVertical].includes(t)?nt({top:_({align:t,contentElPos:i,referenceElPos:a,spacing:n}),windowHeight:o,contentHeight:i.height}):!![z.Left,z.Right,z.CenterHorizontal].includes(t)&&et({left:tt({align:t,contentElPos:i,referenceElPos:a,spacing:n}),windowWidth:r,contentWidth:i.width})}))||t}(r,E),j=function(t,e,n){var r,o,i=n.spacing,a=n.windowWidth,c=n.windowHeight,l=n.contentElViewportPos,s=n.referenceElViewportPos,u=[t].concat(S(ot[t]));switch(e){case z.Top:case z.Bottom:case z.CenterVertical:return null!==(r=u.find((function(t){return et({contentWidth:t===W.Fit?s.width:l.width,windowWidth:a,left:tt({contentElPos:l,referenceElPos:s,spacing:i,align:e,justify:t})})})))&&void 0!==r?r:ot[t][0];case z.Left:case z.Right:case z.CenterHorizontal:return null!==(o=u.find((function(t){return nt({contentHeight:t===W.Fit?s.height:l.height,windowHeight:c,top:_({contentElPos:l,referenceElPos:s,spacing:i,align:e,justify:t})})})))&&void 0!==o?o:ot[t][0]}}(o,P,E),O=function(t){var e,n,r=t.align,o=t.justify,i=Y[r],a=null!==(e=i.x)&&void 0!==e?e:X[o],c=null!==(n=i.y)&&void 0!==n?n:U[o];return"".concat(a," ").concat(c)}({align:P,justify:j}),C=function(t,e){var n=.8;switch(t){case z.Top:return"translate3d(0, ".concat(e,"px, 0) scale(").concat(n,")");case z.Bottom:return"translate3d(0, -".concat(e,"px, 0) scale(").concat(n,")");case z.Left:return"translate3d(".concat(e,"px, 0, 0) scale(").concat(n,")");case z.Right:return"translate3d(-".concat(e,"px, 0, 0) scale(").concat(n,")");case z.CenterHorizontal:case z.CenterVertical:return"scale(".concat(n,")")}}(P,n);return 0===Math.floor(u.width)&&o!==W.Fit?{align:r,justify:o,positionCSS:{left:0,top:0,transform:C,transformOrigin:O}}:e?{align:P,justify:j,positionCSS:b(b({},K({align:P,justify:j,referenceElDocumentPos:l,contentElDocumentPos:d,spacing:n})),{},{transformOrigin:O,transform:C})}:{align:P,justify:j,positionCSS:b(b({},Q({align:P,justify:j,referenceElDocumentPos:l,contentElDocumentPos:d,spacing:n,windowHeight:y,windowWidth:w})),{},{transformOrigin:O,transform:C})}}var I={top:0,bottom:0,left:0,right:0,height:0,width:0},k=function(t,e){var n=t.getBoundingClientRect(),r=n.top,o=n.bottom,i=n.left,a=n.right,c=n.width;return{top:r,bottom:o,left:i,right:a,height:t.offsetHeight,width:e?c:parseFloat(getComputedStyle(t).width)}};function Z(t,e,n){if(!t)return I;var r=k(t,n),o=r.top,i=r.bottom,a=r.left,c=r.right,l=r.height,s=r.width;if(e){var u=e.scrollTop,f=e.scrollLeft,d=e.getBoundingClientRect();return{top:o+u-d.top,bottom:i+u-d.bottom,left:a+f-d.left,right:c+f-d.right,height:l,width:s}}var p=window,g=p.scrollX,h=p.scrollY;return{top:o+h,bottom:i+h,left:a+g,right:c+g,height:l,width:s}}function J(t,e,n){if(!t)return I;var r=k(t,n),o=r.top,i=r.bottom,a=r.left,c=r.right,l=r.height,s=r.width;if(e){var u=e.getBoundingClientRect();return{top:o-u.top,bottom:i-u.bottom,left:a-u.left,right:c-u.right,height:l,width:s}}return{top:o,bottom:i,left:a,right:c,height:l,width:s}}var U=(P(R={},W.Start,"top"),P(R,W.Middle,"center"),P(R,W.End,"bottom"),P(R,W.Fit,"center"),R),X=(P(T={},W.Start,"left"),P(T,W.Middle,"center"),P(T,W.End,"right"),P(T,W.Fit,"center"),T),Y=(P(V={},z.Left,{x:"right"}),P(V,z.Right,{x:"left"}),P(V,z.Top,{y:"bottom"}),P(V,z.Bottom,{y:"top"}),P(V,z.CenterHorizontal,{x:"center"}),P(V,z.CenterVertical,{y:"center"}),V);var $=(P(F={},W.Start,{top:0}),P(F,W.End,{bottom:0}),P(F,W.Middle,(function(t){var e=t.contentElDocumentPos,n=t.referenceElDocumentPos;return{top:"".concat(n.height/2-e.height/2,"px")}})),P(F,W.Fit,{top:0,bottom:0}),F),q=(P(M={},W.Start,{left:0}),P(M,W.End,{right:0}),P(M,W.Middle,(function(t){var e=t.contentElDocumentPos,n=t.referenceElDocumentPos;return{left:"".concat(n.width/2-e.width/2,"px")}})),P(M,W.Fit,{left:0,right:0}),M),G=(P(N={},z.Top,{constant:function(t){var e=t.spacing;return{bottom:"calc(100% + ".concat(e,"px)")}},justifyPositions:q}),P(N,z.Bottom,{constant:function(t){var e=t.spacing;return{top:"calc(100% + ".concat(e,"px)")}},justifyPositions:q}),P(N,z.CenterVertical,{constant:function(t){var e=t.referenceElDocumentPos;return{top:"calc(".concat(e.height/2,"px - 50%)")}},justifyPositions:q}),P(N,z.Left,{constant:function(t){var e=t.spacing;return{right:"calc(100% + ".concat(e,"px)")}},justifyPositions:$}),P(N,z.Right,{constant:function(t){var e=t.spacing;return{left:"calc(100% + ".concat(e,"px)")}},justifyPositions:$}),P(N,z.CenterHorizontal,{constant:function(t){var e=t.referenceElDocumentPos;return{left:"calc(".concat(e.width/2,"px - 50%)")}},justifyPositions:$}),N);function K(t){var e,n=t.align,r=t.justify,o=t.referenceElDocumentPos,i=t.contentElDocumentPos,a=t.spacing,c=G[n],l=c.justifyPositions[r],s={contentElDocumentPos:i,referenceElDocumentPos:o,spacing:a};return b(b({},null===(e=c.constant)||void 0===e?void 0:e.call(c,s)),"function"==typeof l?l(s):l)}function Q(t){var e=t.align,n=t.justify,r=t.referenceElDocumentPos,o=t.contentElDocumentPos,i=t.spacing,a=t.windowWidth,c=t.windowHeight,l=tt({align:e,justify:n,referenceElPos:r,contentElPos:o,spacing:i}),s="".concat(l,"px"),u="".concat(_({align:e,justify:n,referenceElPos:r,contentElPos:o,spacing:i}),"px");return n!==W.Fit?{left:s,top:u}:[z.Left,z.Right,z.CenterHorizontal].includes(e)?{left:s,top:u,bottom:"".concat(c-r.bottom,"px")}:{left:s,top:u,right:"".concat(a-(l+r.width),"px")}}function _(t){var e=t.align,n=t.justify,r=t.contentElPos,o=t.referenceElPos,i=t.spacing;switch(e){case z.Left:case z.Right:case z.CenterHorizontal:switch(n){case W.Start:case W.Fit:return o.top;case W.End:return o.top+o.height-r.height;case W.Middle:default:return o.top-(r.height-o.height)/2}case z.CenterVertical:return o.top-(r.height-o.height)/2;case z.Top:return o.top-r.height-i;case z.Bottom:default:return o.top+o.height+i}}function tt(t){var e=t.align,n=t.justify,r=t.contentElPos,o=t.referenceElPos,i=t.spacing;switch(e){case z.Top:case z.Bottom:case z.CenterVertical:switch(n){case W.End:return o.left+o.width-r.width;case W.Middle:return o.left-(r.width-o.width)/2;case W.Start:case W.Fit:default:return o.left}case z.Left:return o.left-r.width-i;case z.Right:return o.left+o.width+i;case z.CenterHorizontal:default:return o.left-(r.width-o.width)/2}}function et(t){var e=t.left,n=t.windowWidth,r=t.contentWidth;return e>=0&&!(e+r>n)}function nt(t){var e=t.top,n=t.windowHeight,r=t.contentHeight;return e>=0&&!(e+r>n)}var rt=(P(B={},z.Top,[z.Bottom]),P(B,z.Bottom,[z.Top]),P(B,z.Left,[z.Right]),P(B,z.Right,[z.Left]),P(B,z.CenterHorizontal,[z.Left,z.Right]),P(B,z.CenterVertical,[z.Top,z.Bottom]),B);var ot=(P(L={},W.Start,[W.End,W.Middle]),P(L,W.Middle,[W.End,W.Start]),P(L,W.End,[W.Start,W.Middle]),P(L,W.Fit,[W.Middle,W.Start,W.End]),L);var it,at,ct,lt,st,ut=["active","spacing","align","justify","adjustOnMutation","children","className","popoverZIndex","refEl","usePortal","portalClassName","portalContainer","portalRef","scrollContainer","onEnter","onEntering","onEntered","onExit","onExiting","onExited"],ft=["transform"],dt=c(it||(it=C(["\n  position: absolute;\n  transition: transform ","ms ease-in-out,\n    opacity ","ms ease-in-out;\n  opacity: 0;\n"])),y.default,y.default),pt={attributes:!0,characterData:!0,childList:!0,subtree:!0},gt=m("popover-content"),ht=e((function(e,a){var m,E=e.active,b=void 0!==E&&E,S=e.spacing,D=void 0===S?10:S,H=e.align,R=void 0===H?z.Bottom:H,T=e.justify,V=void 0===T?W.Start:T,F=e.adjustOnMutation,M=void 0!==F&&F,N=e.children,B=e.className,L=e.popoverZIndex,I=e.refEl,k=e.usePortal,U=void 0===k||k,X=e.portalClassName,Y=e.portalContainer,$=e.portalRef,q=e.scrollContainer,G=e.onEnter,K=e.onEntering,Q=e.onEntered,_=e.onExit,tt=e.onExiting,et=e.onExited,nt=O(e,ut),rt=x(n(null),2),ot=rt[0],it=rt[1],ht=x(n(null),2),mt=ht[0],vt=ht[1],wt=x(n(0),2),yt=wt[0],Et=wt[1],bt=g().setIsPopoverOpen,Pt=h(),jt=Pt.portalContainer,Ot=Pt.scrollContainer;jt=Y||jt,Ot=q||Ot,U&&Ot&&(Ot.contains(jt)||v.warn("To ensure correct positioning make sure that the portalContainer element is inside of the scrollContainer"));var Ct=t.useRef(mt);Ct.current=mt;var xt=null;if(I&&I.current)xt=I.current;else if(ot){var St=ot.parentNode;St&&St instanceof HTMLElement&&(xt=St)}var Dt=s(),Ht=M&&b,Rt=u(xt,pt,Date.now,Ht),Tt=u(null==mt?void 0:mt.parentNode,pt,Date.now,Ht),Vt=f(J(xt,Ot,!0)),Ft=f(J(null==mt?void 0:mt.parentNode,Ot)),Mt=f(r((function(){return Z(xt,Ot,!0)}),[xt,Ot,Dt,Rt,b,R,V,yt])),Nt=f(r((function(){return Z(mt)}),[null==mt?void 0:mt.parentNode,Dt,Tt,b,R,V,yt])),Bt=d(V),Lt=d(R),zt=Bt!==V&&(V===W.Fit||Bt===W.Fit)||Lt!==R&&V===W.Fit;p((function(){zt&&Et((function(t){return t+1}))}),[zt]);var Wt=x(n(!1),2),At=Wt[0],It=Wt[1];if(p((function(){return It(!0)}),[]),!At)return null;var kt,Zt=A({useRelativePositioning:!U,spacing:D,align:R,justify:V,referenceElViewportPos:Vt,referenceElDocumentPos:Mt,contentElViewportPos:Ft,contentElDocumentPos:Nt,scrollContainer:Ot}),Jt=Zt.align,Ut=Zt.justify,Xt=Zt.positionCSS,Yt=Xt.transform,$t=O(Xt,ft),qt=c(at||(at=C(["\n      opacity: 1;\n      position: ",";\n      pointer-events: initial;\n    "])),U?"":"absolute"),Gt=U?w:o,Kt={className:jt?void 0:X,container:null!==(m=jt)&&void 0!==m?m:void 0,portalRef:$},Qt=U?Kt:{};return kt=null==N?null:"function"==typeof N?N({align:Jt,justify:Ut,referenceElPos:Mt}):N,t.createElement(i,{nodeRef:Ct,in:b,timeout:y.default,mountOnEnter:!0,unmountOnExit:!0,appear:!0,onEntering:K,onEnter:G,onEntered:function(){bt(!0);for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];null==Q||Q.apply(void 0,e)},onExiting:tt,onExit:_,onExited:function(){bt(!1);for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];null==et||et.apply(void 0,e)}},(function(e){var n;return t.createElement(t.Fragment,null,t.createElement("span",{ref:it,className:c(ct||(ct=C(["\n                display: none;\n              "])))}),t.createElement(Gt,Qt,t.createElement("div",j({},nt,{ref:a,className:l(dt,c($t),(n={},P(n,c({transform:Yt}),"entering"===e||"exiting"===e),P(n,qt,"entered"===e),P(n,c(lt||(lt=C(["\n                      z-index: ",";\n                    "])),L),"number"==typeof L),n),B,P({},c(st||(st=C(["\n                      transition-delay: 0ms;\n                    "]))),"exiting"===e))}),t.createElement("div",{ref:vt,className:gt},kt))))}))}));ht.displayName="Popover",ht.propTypes={children:a.oneOfType([a.node,a.func]),active:a.bool,className:a.string,align:a.oneOf(Object.values(z)),justify:a.oneOf(Object.values(W)),refEl:a.shape({current:"undefined"!=typeof window?a.instanceOf(Element):a.any}),usePortal:a.bool,portalClassName:a.string,spacing:a.number,adjustOnMutation:a.bool};var mt={getAlign:function(t,e){switch(t){case"top":return"end";case"bottom":return"start";default:switch(e){case"middle":case"fit":return"center";default:return e}}},getJustify:function(t,e){switch(t){case"left":return"end";case"right":return"start";default:switch(e){case"middle":case"fit":return"center";default:return e}}}};export{z as Align,W as Justify,ht as Popover,mt as TestUtils,gt as contentClassName,ht as default};
//# sourceMappingURL=index.js.map
