"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.requireValidIpAddress = void 0;
const utils_1 = require("../utils");
const utils_2 = require("../routes/conversations/utils");
function requireValidIpAddress() {
    return (req, res, next) => {
        const reqId = (0, utils_1.getRequestId)(req);
        const { ip } = req;
        if (!(0, utils_2.isValidIp)(ip)) {
            return (0, utils_1.sendErrorResponse)({
                reqId,
                res,
                httpStatus: 400,
                errorMessage: `The request has an invalid IP address: ${ip}`,
            });
        }
        res.locals.customData.ip = ip;
        (0, utils_1.logRequest)({
            reqId,
            message: `Request IP ${ip} is allowed`,
        });
        next();
    };
}
exports.requireValidIpAddress = requireValidIpAddress;
//# sourceMappingURL=requireValidIpAddress.js.map